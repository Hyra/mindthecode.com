<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="Mindthecode" type="application/atom+xml"><link rel="icon" href="/favicon.png"><meta name="author" content="Stef van den Ham @stefvdham"><meta property="og:type" content="article"><meta property="og:image" content="http://mindthecode.com/images/og_image.png"><meta property="og:site_name" content="Mindthecode"><meta name="twitter:creator" content="@stefvdham"><meta name="twitter:card" content="summary"><meta name="twitter:image:" content="http://mindthecode.com/images/og_image.png"><meta name="keywords" content="html, javascript, code, hacking, tutorial, tutorials, web, css"><link rel="author" href="https://plus.google.com/102230925443628784177?rel=author"><link rel="canonical" href="http://mindthecode.com"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><title>How to handle multiple domains with CakePHP - Mindthecode</title><meta property="og:title" content="How to handle multiple domains with CakePHP"><meta property="og:url" content="http://mindthecode.com/how-to-handle-multiple-domains-with-cakephp/"><meta property="og:description" content="The following setup can work nicely when you develop your sites locally and don't want to change the configuration every time you upload it."><meta name="twitter:title" content="How to handle multiple domains with CakePHP"><meta name="twitter:description" content="The following setup can work nicely when you develop your sites locally and don't want to change the configuration every time you upload it."><meta name="description" content="The following setup can work nicely when you develop your sites locally and don't want to change the configuration every time you upload it."><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><header><a href="/" class="logo"><img src="http://mindthecode.com/logo.png" height="30" class="floating"></a><nav><ul><li><a href="/">Blog</a></li><li><a href="/about">About</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article class="post"><header><h1><span>How to handle multiple domains with CakePHP</span></h1><h5><span></span></h5><time datetime="2011-05-21T22:00:00.000Z" class="post__time">May 22 2011</time></header><hr/><p>Lately, we’ve been working with multiple environments/servers for our websites to be able to have them approved by clients before going live. However, following set up can also work nicely when you develop your sites locally and don’t want to keep changing the configuration every time you upload it.</p>
<h2 id="Setting-up-the-database-config-file"><a href="#Setting-up-the-database-config-file" class="headerlink" title="Setting up the database config file"></a>Setting up the database config file</h2><p>So, what changes in your config? Not all that much. Let’s have a look at the default database.php config file</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">DATABASE_CONFIG</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> $<span class="token keyword">default</span> <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>
    <span class="token string">'driver'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
    <span class="token string">'persistent'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">'host'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token string">'login'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'password'</span><span class="token punctuation">,</span>
    <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'database_name'</span><span class="token punctuation">,</span>
    <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> $test <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>
    <span class="token string">'driver'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
    <span class="token string">'persistent'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">'host'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token string">'login'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'password'</span><span class="token punctuation">,</span>
    <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'test_database_name'</span><span class="token punctuation">,</span>
    <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>$default</code> database config is used when you don’t specify anything. The <code>$test</code> database is used by SimpleTest. Let’s say you want to have a <code>local</code> environment and one for when you’re on your live/production server. Below is the database config I use</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">DATABASE_CONFIG</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> $local <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>
        <span class="token string">'driver'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'persistent'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string">'encoding'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
        <span class="token string">'host'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
        <span class="token string">'login'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'/Applications/MAMP/tmp/mysql/mysql.sock'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> $production <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>
        <span class="token string">'driver'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'persistent'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string">'encoding'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
        <span class="token string">'host'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
        <span class="token string">'login'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'database'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'port'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$_SERVER<span class="token punctuation">[</span><span class="token string">'SERVER_NAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>$_SERVER<span class="token punctuation">[</span><span class="token string">'SERVER_NAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// Are we working locally?</span>
          <span class="token keyword">case</span> <span class="token string">'www.YOURLOCALURL.com'</span><span class="token punctuation">:</span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">default</span> <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>local<span class="token punctuation">;</span>
            Configure<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">'www.YOURLIVEURL.com'</span><span class="token punctuation">:</span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">default</span> <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>production<span class="token punctuation">;</span>
            Configure<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token punctuation">:</span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">default</span> <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>production<span class="token punctuation">;</span>
            Configure<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// If there's no SERVER_NAME we're probably using bake from the command line, so use local</span>
        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">default</span> <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>local<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>As you can see we check the <code>$_SERVER[&#39;SERVER_NAME&#39;]</code> . Locally I like to work with <code>dev.domain.com</code> domains, but if you’re using some sort of <code>localhost</code> structure this will work fine as well. So, depending on the server(name) you’re on the correct database credentials are put into the <code>$default</code> config. Obviously, you can extend the database configs as much as you want. We usually work with 4 arrays: local, development, staging and production. As a bonus, we can set the <code>debug value</code> for these environments accordingly as well.</p>
<h2 id="Thoughts"><a href="#Thoughts" class="headerlink" title="Thoughts?"></a>Thoughts?</h2><p>I have been considering putting this logic in the <code>bootstrap.php</code>, but not sure if this is where one would want this logic. Do you guys use a similar setup, or know ways to improve or extend this? Let me know in the comments!</p>
<hr/><ul class="tags"><li>Tags: </li><li class="post__tag__item"><a href="/tags/cakephp/" class="post__tag__link">cakephp</a></li><li class="post__tag__item"><a href="/tags/php/" class="post__tag__link">php</a></li></ul><a href="https://twitter.com/intent/tweet" class="twitter-share-button">Tweet</a><hr/><h2>Questions or comments?</h2><p>As always, if you have any questions or comments, you can find me on <a href="http://twitter.com/stefvdham"   target="_blank">Twitter</a>.</p><div class="prevnext"><a href="/using-sass-in-your-next-cakephp-project/" class="prevnext-prev"><p>← Prev</p></a><a href="/how-to-remove-a-submodule-from-your-git-repository/" class="prevnext-next"><p>Next →</p></a></div></article></main><footer><a href="/"><img src="http://mindthecode.com/images/mtc_inv_white.png" alt="Mindthecode" class="floating"></a><br><p>Made with ❤ and 🍺</p><p>Follow me on <a target="_blank" href="https://twitter.com/stefvdham">Twitter</a> or <a target="_blank" href="https://www.facebook.com/mindthecode/">Facebook</a></p><p>© Copyright 2011-2017</p></footer><script src="/js/main.js"></script><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=mindthecode" id="_carbonads_js"></script></body></html>