<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="Mindthecode" type="application/atom+xml"><link rel="icon" href="/favicon.png"><meta name="author" content="Stef van den Ham @stefvdham"><meta property="og:type" content="article"><meta property="og:image" content="http://mindthecode.com/images/og_image.png"><meta property="og:site_name" content="Mindthecode"><meta name="twitter:creator" content="@stefvdham"><meta name="twitter:card" content="summary"><meta name="twitter:image:" content="http://mindthecode.com/images/og_image.png"><meta name="keywords" content="html, javascript, code, hacking, tutorial, tutorials, web, css"><link rel="author" href="https://plus.google.com/102230925443628784177?rel=author"><link rel="canonical" href="http://mindthecode.com"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><title>Recording a website with PhantomJS and FFMpeg - Mindthecode</title><meta property="og:title" content="Recording a website with PhantomJS and FFMpeg"><meta property="og:url" content="http://mindthecode.com/recording-a-website-with-phantomjs-and-ffmpeg/"><meta property="og:description" content="When I realised you could easily generate screenshots from a site with PhantomJS I just needed to know if I could take it one step further, and record a video."><meta name="twitter:title" content="Recording a website with PhantomJS and FFMpeg"><meta name="twitter:description" content="When I realised you could easily generate screenshots from a site with PhantomJS I just needed to know if I could take it one step further, and record a video."><meta name="description" content="When I realised you could easily generate screenshots from a site with PhantomJS I just needed to know if I could take it one step further, and record a video."><!-- != css('css/main')--><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><header><a href="/" class="logo"><img src="http://mindthecode.com/logo.png" height="30" class="floating"></a><nav><ul><li><a href="/">Blog</a></li><li><a href="/about">About</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article class="post"><header><h1><span>Recording a website with PhantomJS and FFMpeg</span></h1><h5><span>&quot;I just needed to know if I could take it one step further&quot;</span></h5><time datetime="2014-05-24T22:00:00.000Z" class="post__time">May 25 2014</time></header><hr/><p>When I realised you could easily generate screenshots from a site with PhantomJS I just needed to know if I could take it one step further, and record a video.</p>
<h2 id="The-goal"><a href="#The-goal" class="headerlink" title="The goal"></a>The goal</h2><p>What I wanted was to record 10 seconds of video from a random website and output it as a .mp4. For this short demo I decided we should go with one of the fun examples on Pixi.JS as they’re interesting to capture.</p>
<p>Here it is, a <a href="http://www.goodboydigital.com/pixijs/examples/12-2/" target="_blank" rel="external">Pixi dragon</a></p>
<h2 id="The-ingredients"><a href="#The-ingredients" class="headerlink" title="The ingredients"></a>The ingredients</h2><h2 id="PhantomJS"><a href="#PhantomJS" class="headerlink" title="PhantomJS"></a>PhantomJS</h2><p>In case you’ve been hiding, <a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a> is a headless scriptable webkit browser with a Javascript API. We will use it to generate screenshots of a site.</p>
<h2 id="FFMPeg"><a href="#FFMPeg" class="headerlink" title="FFMPeg"></a>FFMPeg</h2><p><a href="http://www.ffmpeg.org/" target="_blank" rel="external">FFMPeg</a> is our all purpose video and audio toolbox to record, convert and stream on the command line.</p>
<p>With these two tools installed we are ready to create a video.</p>
<!-- Rectangle Ad -->
<p><center><br><ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-0534492338431642" data-ad-slot="3199566305"></ins><br></center></p>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<h2 id="From-the-top"><a href="#From-the-top" class="headerlink" title="From the top"></a>From the top</h2><p>Capturing a webpage as an image with PhantomJS is easy stuff. They have a example on how to do this <a href="https://github.com/ariya/phantomjs/blob/master/examples/technews.js" target="_blank" rel="external">over here</a>, so let’s strip it down to what we need and save it as <code>runner.js</code></p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span>viewportSize <span class="token operator">=</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">640</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">480</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

page<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://www.goodboydigital.com/pixijs/examples/12-2/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  page<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'dragon.png'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> format<span class="token punctuation">:</span> <span class="token string">"png"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  phantom<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can now run this with:</p>
<pre class=" language-bash"><code class="language-bash">$ phantomjs runner.js
</code></pre>
<p>After a few moments PhantomJS will have booted up and rendered an image. But .. it’s white! That’s because PhantomJS takes the image before the <code>&lt;canvas&gt;</code> has actually fully loaded and started the animation. Let’s add a little delay before we write the image.</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span>viewportSize <span class="token operator">=</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">640</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">480</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

page<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://www.goodboydigital.com/pixijs/examples/12-2/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// Add a little delay before capturing the image</span>
    page<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'dragon.png'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> format<span class="token punctuation">:</span> <span class="token string">"png"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    phantom<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This time, you should end up with an image of .. a dragon!</p>
<p><img src="/images/screenshots/dragon01.png" alt="Pixi Dragon"></p>
<h2 id="Rendering-multiple-images"><a href="#Rendering-multiple-images" class="headerlink" title="Rendering multiple images"></a>Rendering multiple images</h2><p>From here it’s easy enough to render multiple images with an interval. Create a folder <code>frames</code> and modify the runner code to capture 50 images:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span>viewportSize <span class="token operator">=</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">640</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">480</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

page<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://www.goodboydigital.com/pixijs/examples/12-2/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Initial frame</span>
    <span class="token keyword">var</span> frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Add an interval every 25th second</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Render an image with the frame name</span>
      page<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'frames/dragon'</span><span class="token operator">+</span><span class="token punctuation">(</span>frame<span class="token operator">++</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> format<span class="token punctuation">:</span> <span class="token string">"png"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Exit after 50 images</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>frame <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        phantom<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Sweet, we end up with 50 frames of the dragon. When flicking through them it looks like it’s flying, so we’re almost there!</p>
<h2 id="Rendering-a-movie"><a href="#Rendering-a-movie" class="headerlink" title="Rendering a movie"></a>Rendering a movie</h2><p>Now we know how to get the frames we want, we need to figure out how to feed them to ffmpeg. Traditionally, one would first render all the frames and then use an ffmpeg command to stitch the images to a movie. This would look a bit like this:</p>
<pre class=" language-bash"><code class="language-bash">$ ffmpeg -start_number 10 -i frames/dragon%02d.png -c:v libx264 -r 25 -pix_fmt yuv420p out.mp4
</code></pre>
<p>Notice I added a <code>-start_number</code> parameter because the frames we generated don’t have a leading 0.</p>
<p>So, at this point we have a movie from the site we wanted. Good stuff, but we can do better. Wouldn’t it be nice if we could squeeze it all in one command? We can! If we modify the runner code to output images to the terminal, we can pipe it as food to ffmpeg, which accepts the <code>image2pipe</code> parameter.</p>
<p>Let’s alter the render method a bit:</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span>viewportSize <span class="token operator">=</span> <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">640</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">480</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

page<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://www.goodboydigital.com/pixijs/examples/12-2/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    page<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'/dev/stdout'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> format<span class="token punctuation">:</span> <span class="token string">"png"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We have removed the timeout as we don’t need it anymore and we took out the frame counting code as we will tell ffmpeg how long to record for.</p>
<p>Now, when we run the runner again, the CLI will throw raw image data at us, so don’t! :)</p>
<p>Instead, let’s add a pipe to it and feed that juicy image data to ffmpeg instead, who can devour it much better than we can:</p>
<pre class=" language-bash"><code class="language-bash">$ phantomjs runner.js <span class="token operator">|</span> ffmpeg -y -c:v png -f image2pipe -r 25 -t 10  -i - -c:v libx264 -pix_fmt yuv420p -movflags +faststart dragon.mp4
</code></pre>
<p>This might take a while, but eventually you will end up with a file <code>dragon.mp4</code> that’s a lot smoother than our first attempt. This is because we feed a lot more images to ffmpeg.</p>
<p>The important flags to notice in the ffmpeg command is <code>-t 10</code> which tells it to limit the capture to 10 seconds, and <code>-f image2pipe</code> because it tells ffmpeg to listen to the image stream we created.</p>
<p><img src="/images/screenshots/dragon.gif" alt="Pixi Dragon"></p>
<h2 id="Wrapping-it-up"><a href="#Wrapping-it-up" class="headerlink" title="Wrapping it up"></a>Wrapping it up</h2><p>And there we go. We can stream images through PhantomJS and feed them to ffmpeg to create a movie. I haven’t thought of a practical purpose for this, but maybe someone else will.</p>
<p>I hope you like the proof of concept.</p>
<p>Happy coding!</p>
<hr/><ul class="tags"><li>Tags: </li><li class="post__tag__item"><a href="/tags/ffmpeg/" class="post__tag__link">ffmpeg</a></li><li class="post__tag__item"><a href="/tags/phantomjs/" class="post__tag__link">phantomjs</a></li></ul><a href="https://twitter.com/intent/tweet" class="twitter-share-button">Tweet</a><hr/><h2>Questions or comments?</h2><p>As always, if you have any questions or comments, you can find me on <a href="http://twitter.com/stefvdham"   target="_blank">Twitter</a>.</p><div class="prevnext"><a href="/lets-build-an-angularjs-app-with-browserify-and-gulp/" class="prevnext-prev"><p>← Prev</p></a><a href="/writing-browserify-modules-for-your-angular-app/" class="prevnext-next"><p>Next →</p></a></div></article></main><footer><a href="/"><img src="http://mindthecode.com/images/mtc_inv_white.png" alt="Mindthecode" class="floating"></a><br><p>Made with ❤ and 🍺</p><p>Follow me on <a target="_blank" href="https://twitter.com/stefvdham">Twitter</a> or <a target="_blank" href="https://www.facebook.com/mindthecode/">Facebook</a></p><p>© Copyright 2011-2017</p></footer><script src="/js/main.js"></script><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=mindthecode" id="_carbonads_js"></script></body></html>